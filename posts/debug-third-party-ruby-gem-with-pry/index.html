<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect | hexdevs</title><meta name=keywords content="Open Source,ruby,ruby on rails,guides"><meta name=description content="A quick guide to help you debug a Third-Party Ruby Gem using `bundle open`, `pry`, and `git bisect`."><meta name=author content="Thiago Araujo, Stefanni Brasil"><link rel=canonical href=https://www.hexdevs.com/posts/debug-third-party-ruby-gem-with-pry/><link href=https://www.hexdevs.com/assets/css/stylesheet.min.02a5a3dd0431cd7b3e4f470d6da67224042b1fb9f192ff7d39ea424179f1269b.css integrity="sha256-AqWj3QQxzXs+T0cNbaZyJAQrH7nxkv99OepCQXnxJps=" rel="preload stylesheet" as=style><link rel=icon href=https://www.hexdevs.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.hexdevs.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.hexdevs.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.hexdevs.com/apple-touch-icon.png><link rel=mask-icon href=https://www.hexdevs.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.75.1"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-205465720-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect"><meta property="og:description" content="A quick guide to help you debug a Third-Party Ruby Gem using `bundle open`, `pry`, and `git bisect`."><meta property="og:type" content="article"><meta property="og:url" content="https://www.hexdevs.com/posts/debug-third-party-ruby-gem-with-pry/"><meta property="og:image" content="https://www.hexdevs.com/images/posts/hexdevs-debugging-ruby-gems-with-pry-git-bisect-bundler.jpg"><meta property="article:published_time" content="2022-04-26T16:21:30-07:00"><meta property="article:modified_time" content="2022-05-04T13:21:58-07:00"><meta property="og:site_name" content="hexdevs | Take control of your Developer career"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.hexdevs.com/images/posts/hexdevs-debugging-ruby-gems-with-pry-git-bisect-bundler.jpg"><meta name=twitter:title content="Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect"><meta name=twitter:description content="A quick guide to help you debug a Third-Party Ruby Gem using `bundle open`, `pry`, and `git bisect`."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect","name":"Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect","description":"Are you trying to debug a Ruby gem but not sure how? Here\u0026amp;rsquo;s a quick way to debug any Ruby Project using Pry and Git Bisect.\nWhen triaging some open issues on Faker, an ‚Ä¶","keywords":["Open Source","ruby","ruby on rails","guides"],"articleBody":"Are you trying to debug a Ruby gem but not sure how? Here‚Äôs a quick way to debug any Ruby Project using Pry and Git Bisect.\nWhen triaging some open issues on Faker, an open-source Ruby gem, I came across Issue #2482. I was able to reproduce the problem. Turns out the bug was already fixed by this PR, but version v2.20.0 was released before that.\nI thought this would be a great opportunity to show you how I debugged this issue so you can learn some new tricks. Let‚Äôs assume the issue was not already fixed so I can show you exactly how to debug it yourself. And then you can use these tricks on your projects. Sounds good?\nNote: this guide assumes you have a bug to fix. If you don‚Äôt and just want to follow along, clone this repo. You should have Pry installed and the $EDITOR environment variable set to work with your favorite editor.\n1. Run the failing code to reproduce the bug The first step is to run the failing code and find a way to reproduce the bug. In this case, the gem randomly generates a nil game title, which is not good.\nTo reproduce this bug, install faker v2.20.0 and run the code below. The gem will randomly generate a small number of nil game titles.\nLet‚Äôs write a short test:\n# faker_game_title_test.rb require 'test/unit/assertions' include Test::Unit::Assertions require 'faker' 1000.times do assert_not_nil Faker::Game.title end Then run the test and you‚Äôll be able to reproduce the error:\n$ ruby faker_game_title_test.rb  was expected to not be nil. (Test::Unit::AssertionFailedError) Great! We reproduced the bug and have something to work with.\n2. Run bundle open [gem-name] to access the source code Now we need to understand why the bug is happening.\nLet‚Äôs take a look at the source code:\n$ bundle open faker With the source code open, we can now take a peek inside.\n3. Add binding.pry to invoke the debugger We want to debug the code and see what‚Äôs going on.\nIf you look at how Faker::Game.title is implemented here, you‚Äôll see that it just calls Faker::Base.fetch.\nLet‚Äôs invoke the debugger where the fetch method is defined:\ndef fetch(key) fetched = sample(translate(\"faker.#{key}\")) require \"pry\" # binding.pry if fetched.nil? # if fetched\u0026.match(%r{^/}) \u0026\u0026 fetched\u0026.match(%r{/$}) regexify(fetched) else fetched end end Now whenever this method is called, and fetched is nil, we intercept the execution and inspect the code üîé\n4. Run the failing code again Now if you run the failing test again, a pry session will start and you‚Äôll be able to debug the code:\n$ ruby faker_game_title_test.rb 97: def fetch(key) 98: fetched = sample(translate(\"faker.#{key}\")) 99: 100: require \"pry\" = 101: binding.pry if fetched.nil? 102: 103: if fetched\u0026.match(%r{^/}) \u0026\u0026 fetched\u0026.match(%r{/$}) # A regex 104: regexify(fetched) 105: else 106: fetched 107: end 108: end 5. Explore and debug the code using pry If you need a quick tutorial on how to use pry, read Getting Started with Pry Debug in 5 minutes.\nWe can see that a random key is picked from the list returned by translate(\"faker.game.title\"). Let‚Äôs inspect this method with show-source [method-name]:\npry(Faker::Game) show-source translate def translate(*args, **opts) opts[:locale] ||= Faker::Config.locale opts[:raise] = true I18n.translate(*args, **opts) #  # (...) end You‚Äôll see that it is just grabbing keys from this yml file.\nIf we run the code, the last entry is indeed nil:\n[17] pry(Faker::Game) I18n.translate(\"faker.game.title\")[-3..] [ [0] \"Command \u0026 Conquer: Rivals\", [1] \"Command \u0026 Conquer: Tiberium Alliances\", [2] nil ] Gotcha! üêû\nRun bundle pristine to clear your changes If you‚Äôve changed the code and want to discard any changes, run:\n$ bundle pristine This will restore the installed gems in the bundle to their pristine condition using the local gem cache from RubyGems. For git gems, a forced checkout will be performed.\n6. Find out when the bug was introduced with git bisect Use git bisect to find the commit that caused the issue. That will give you clues on which files to focus on. You can even use the test script you‚Äôve created to tell you whether a version is good or bad.\nContinuing with our issue, we need to clone the Faker repository:\n$ git clone git@github.com:faker-ruby/faker.git $ cd faker To start the git bisect process, run:\n$ git bisect start We know that version v2.20.0 is broken (bad) and v2.19.0 was working (good), so let‚Äôs mark them appropriately:\n$ git bisect bad v2.20.0 $ git bisect good v2.19.0 Bisecting: 38 revisions left to test after this (roughly 5 steps) [2a6f0cc] Add general documentation for Faker::Camera (#2421) Now you can let git bisect do its magic by telling it to run your test. It will jump between revisions, doing a binary search to find where the bug was introduced. It will then mark the revision as either good or bad depending on the output of your test, and stop.\nTo run a script/test with git bisect, do the following:\n$ git bisect run [your-test-script] Here‚Äôs an example:\n$ git bisect run rake test TEST=faker_game_title_test.rb running rake test TEST=faker_game_title_test.rb Bisecting: 18 revisions left to test after this (roughly 4 steps) [649dd8f] Merge pull request #2442 from sudeeptarlekar/2309-truffleruby-errors running rake test TEST=faker_game_title_test.rb (...) Bisecting: 0 revisions left to test after this (roughly 1 step) [c1998d0] Merge pull request #2457 from Awilum/patch-2 running rake test TEST=faker_game_title_test.rb  was expected to not be nil. (Test::Unit::AssertionFailedError) Bisecting: 0 revisions left to test after this (roughly 0 steps) [722172a] add Command \u0026 Conquer games running rake test TEST=faker_game_title_test.rb  was expected to not be nil. (Test::Unit::AssertionFailedError) 722172a is the first bad commit commit 722172a Date: Mon Jan 31 00:52:58 2022 +0300 add Command \u0026 Conquer games lib/locales/en/game.yml | 12 ++++++++++++ 1 file changed, 12 insertions(+) bisect run success git-bisect found the commit that introduced the bug. And it consists of changes to only one file: lib/locales/en/game.yml. That narrows the list of possible culprits by a lot!\nReally neat, huh?\nWith this information, you know exactly which files to look at. When you‚Äôre done, get back to the original branch by running:\n$ git bisect reset üí° For a great video explanation on how to use git bisect in a large project, check out the talk RailsConf 2015: Breaking Down the Barrier: Demystifying Contributing to Rails @ 50m55s from Eileen Uchitelle.\n7. Open a new issue with reproduction steps With reproduction steps in hand, open a new issue describing the error and how to reproduce it. Give the maintainers a script they can run if you have it.\nSince you‚Äôre here doing all this work, if you have a solution, submit a PR.\nThe issue shared here was already solved, but let‚Äôs pretend you‚Äôre going to fix it. You know that the problem can be fixed by deleting the empty entry on line 233 in this file lib/locales/en/game.yml.\nAfter you removed the empty line, build the gem and install it locally:\n$ gem build faker.gemspec Successfully built RubyGem Name: faker Version: 2.20.0 File: faker-2.20.0.gem $ gem install faker-2.20.0.gem Now if you run the test again, the problem is fixed. Yay! The next step would be to submit a PR following the repository‚Äôs guidelines.\nChecklist: How to Quickly Debug a Ruby Gem Let‚Äôs recap:\n Run the failing code to reproduce the bug Run bundle open [gem-name] to access the source code Add binding.pry to invoke the debugger Run the failing code again Explore and debug the code using pry Find out when the bug was introduced with git bisect Open a new issue with reproduction steps  Voil√†! Now you‚Äôre ready to debug any Ruby gem! üß∞\n By now, you have added a couple of new debugging tricks to your toolbox. Use them on your own projects. git bisect is a neat command to use when debugging any type of project. As well as using pry effectively.\nFor more Pry tips, read Getting Started with Pry Debug in 5 minutes.\nNow go out there and bash some bugs!\n  Did you like this article? You're gonna love these other ones:\n  How to Open Source with Richard Schneeman (@schneems)   How to RSpec a Jbuilder response from a Rails JSON API   [Guide] How to Contribute to Ruby on Rails   ","wordCount":"1366","inLanguage":"en","image":"https://www.hexdevs.com/images/posts/hexdevs-debugging-ruby-gems-with-pry-git-bisect-bundler.jpg","datePublished":"2022-04-26T16:21:30-07:00","dateModified":"2022-05-04T13:21:58-07:00","author":[{"@type":"Person","name":"Thiago Araujo"},{"@type":"Person","name":"Stefanni Brasil"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.hexdevs.com/posts/debug-third-party-ruby-gem-with-pry/"},"publisher":{"@type":"Organization","name":"hexdevs","logo":{"@type":"ImageObject","url":"https://www.hexdevs.com/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://www.hexdevs.com/ accesskey=h title="hexdevs (Alt + H)">hexdevs</a>
<span class=logo-switches><span class=theme-toggle title="(Alt + T)"><a id=theme-toggle accesskey=t><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://podcast.hexdevs.com/ title=Podcast><span>Podcast</span></a></li><li><a href=https://www.hexdevs.com/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.hexdevs.com/about/ title="About us"><span>About us</span></a></li><li><a href=https://academy.hexdevs.com/ title="Get to Senior üöÄ"><span>Get to Senior üöÄ</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect</h1><div class=post-meta>7 min&nbsp;¬∑&nbsp;Thiago Araujo, Stefanni Brasil</div></header><figure class=entry-cover><img src=https://www.hexdevs.com/images/posts/hexdevs-debugging-ruby-gems-with-pry-git-bisect-bundler.jpg alt="Quickly Debug Ruby Gems with Pry, git bisect, and bundler"><p>How to Quickly Debug a Ruby Gem with <code>pry</code>, <code>git bisect</code>, and <code>bundle open</code></p></figure><div class=post-content><p>Are you trying to debug a Ruby gem but not sure how? Here&rsquo;s a quick way to debug any Ruby Project using Pry and Git Bisect.</p><p>When triaging some open issues on Faker, an open-source Ruby gem, I came across <a href=https://github.com/faker-ruby/faker/issues/2482>Issue #2482</a>. I was able to reproduce the problem. Turns out the bug was already fixed by <a href=https://github.com/faker-ruby/faker/pull/2469>this PR</a>, but version <code>v2.20.0</code> was released before that.</p><p>I thought this would be a great opportunity to show you how I debugged this issue so you can learn some new tricks. Let&rsquo;s assume the issue was not already fixed so I can show you exactly how to debug it yourself. And then you can use these tricks on your projects. Sounds good?</p><p><em>Note: this guide assumes you have a bug to fix. If you don&rsquo;t and just want to follow along, clone <a href=https://github.com/hexdevs/debug_gem_example>this repo</a>. You should have Pry installed and the <code>$EDITOR</code> environment variable set to work with your favorite editor</em>.</p><h2 id=1-run-the-failing-code-to-reproduce-the-bug>1. Run the failing code to reproduce the bug<a hidden class=anchor aria-hidden=true href=#1-run-the-failing-code-to-reproduce-the-bug>#</a></h2><p>The first step is to run the failing code and find a way to reproduce the bug. In this case, the gem randomly generates a nil game title, which is not good.</p><p>To reproduce this bug, install <code>faker v2.20.0</code> and run the code below. The gem will randomly generate a small number of <code>nil</code> game titles.</p><p>Let&rsquo;s write a short test:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#75715e># faker_game_title_test.rb</span>

require <span style=color:#e6db74>&#39;test/unit/assertions&#39;</span>
<span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Test</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Assertions</span>

require <span style=color:#e6db74>&#39;faker&#39;</span>

<span style=color:#ae81ff>1000</span><span style=color:#f92672>.</span>times <span style=color:#66d9ef>do</span>
    assert_not_nil <span style=color:#66d9ef>Faker</span><span style=color:#f92672>::</span><span style=color:#66d9ef>Game</span><span style=color:#f92672>.</span>title
<span style=color:#66d9ef>end</span>
</code></pre></div><p>Then run the test and you&rsquo;ll be able to reproduce the error:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ruby faker_game_title_test.rb
  &lt;nil&gt; was expected to not be nil. <span style=color:#f92672>(</span>Test::Unit::AssertionFailedError<span style=color:#f92672>)</span>
</code></pre></div><p>Great! We reproduced the bug and have something to work with.</p><h2 id=2-run-bundle-open-gem-name-to-access-the-source-code>2. Run <code>bundle open [gem-name]</code> to access the source code<a hidden class=anchor aria-hidden=true href=#2-run-bundle-open-gem-name-to-access-the-source-code>#</a></h2><p>Now we need to understand why the bug is happening.</p><p>Let&rsquo;s take a look at the source code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ bundle open faker
</code></pre></div><p>With the source code open, we can now take a peek inside.</p><h2 id=3-add-bindingpry-to-invoke-the-debugger>3. Add <code>binding.pry</code> to invoke the debugger<a hidden class=anchor aria-hidden=true href=#3-add-bindingpry-to-invoke-the-debugger>#</a></h2><p>We want to debug the code and see what&rsquo;s going on.</p><p>If you look at how <code>Faker::Game.title</code> is implemented <a href=https://github.com/faker-ruby/faker/blob/a00b4c6388c69fdafb7e12cbacdb6d8a9927fba5/lib/faker/games/game.rb#L17>here</a>, you&rsquo;ll see that it just calls <code>Faker::Base.fetch</code>.</p><p>Let&rsquo;s invoke the debugger where the <a href=https://github.com/faker-ruby/faker/blob/a00b4c6388c69fdafb7e12cbacdb6d8a9927fba5/lib/faker.rb#L97>fetch method</a> is defined:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>fetch</span>(key)
    fetched <span style=color:#f92672>=</span> sample(translate(<span style=color:#e6db74>&#34;faker.</span><span style=color:#e6db74>#{</span>key<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>))

    require <span style=color:#e6db74>&#34;pry&#34;</span>                 <span style=color:#75715e># &lt;- require pry</span>
    binding<span style=color:#f92672>.</span>pry <span style=color:#66d9ef>if</span> fetched<span style=color:#f92672>.</span>nil?   <span style=color:#75715e># &lt;- invoke pry debugger</span>

    <span style=color:#66d9ef>if</span> fetched<span style=color:#f92672>&amp;.</span>match(<span style=color:#e6db74>%r{^/}</span>) <span style=color:#f92672>&amp;&amp;</span> fetched<span style=color:#f92672>&amp;.</span>match(<span style=color:#e6db74>%r{/$}</span>)
        regexify(fetched)
    <span style=color:#66d9ef>else</span>
        fetched
    <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>Now whenever this method is called, and <code>fetched</code> is <code>nil</code>, we intercept the execution and inspect the code üîé</p><h2 id=4-run-the-failing-code-again>4. Run the failing code again<a hidden class=anchor aria-hidden=true href=#4-run-the-failing-code-again>#</a></h2><p>Now if you run the failing test again, a <code>pry</code> session will start and you&rsquo;ll be able to debug the code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ruby faker_game_title_test.rb

     97: def fetch<span style=color:#f92672>(</span>key<span style=color:#f92672>)</span>
     98:   fetched <span style=color:#f92672>=</span> sample<span style=color:#f92672>(</span>translate<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;faker.#{key}&#34;</span><span style=color:#f92672>))</span>
     99:
    100:   require <span style=color:#e6db74>&#34;pry&#34;</span>
 <span style=color:#f92672>=</span>&gt; 101:   binding.pry <span style=color:#66d9ef>if</span> fetched.nil?
    102:
    103:   <span style=color:#66d9ef>if</span> fetched&amp;.match<span style=color:#f92672>(</span>%r<span style=color:#f92672>{</span>^/<span style=color:#f92672>})</span> <span style=color:#f92672>&amp;&amp;</span> fetched&amp;.match<span style=color:#f92672>(</span>%r<span style=color:#f92672>{</span>/$<span style=color:#f92672>})</span> <span style=color:#75715e># A regex</span>
    104:     regexify<span style=color:#f92672>(</span>fetched<span style=color:#f92672>)</span>
    105:   <span style=color:#66d9ef>else</span>
    106:     fetched
    107:   end
    108: end
</code></pre></div><h2 id=5-explore-and-debug-the-code-using-pry>5. Explore and debug the code using <code>pry</code><a hidden class=anchor aria-hidden=true href=#5-explore-and-debug-the-code-using-pry>#</a></h2><p><em>If you need a quick tutorial on how to use <code>pry</code>, read <a href=https://www.hexdevs.com/posts/pry-debug-in-5-minutes/>Getting Started with Pry Debug in 5 minutes</a>.</em></p><p>We can see that a random key is picked from the list returned by <code>translate("faker.game.title")</code>. Let&rsquo;s inspect this method with <code>show-source [method-name]</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pry<span style=color:#f92672>(</span>Faker::Game<span style=color:#f92672>)</span>&gt; show-source translate
def translate<span style=color:#f92672>(</span>*args, **opts<span style=color:#f92672>)</span>
  opts<span style=color:#f92672>[</span>:locale<span style=color:#f92672>]</span> <span style=color:#f92672>||=</span> Faker::Config.locale
  opts<span style=color:#f92672>[</span>:raise<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> true
  I18n.translate<span style=color:#f92672>(</span>*args, **opts<span style=color:#f92672>)</span>  <span style=color:#75715e># &lt;------</span>
  <span style=color:#75715e># (...)</span>
end
</code></pre></div><p>You&rsquo;ll see that it is just grabbing keys from <a href=https://github.com/KingYoSun/faker/blob/ddb6fce1dd87142139dbceb73981e1a8fa47dcf6/lib/locales/en/game.yml#L233>this yml file</a>.</p><p>If we run the code, the last entry is indeed nil:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>17<span style=color:#f92672>]</span> pry<span style=color:#f92672>(</span>Faker::Game<span style=color:#f92672>)</span>&gt; I18n.translate<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;faker.game.title&#34;</span><span style=color:#f92672>)[</span>-3..<span style=color:#f92672>]</span>
<span style=color:#f92672>[</span>
    <span style=color:#f92672>[</span>0<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;Command &amp; Conquer: Rivals&#34;</span>,
    <span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;Command &amp; Conquer: Tiberium Alliances&#34;</span>,
    <span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> nil
<span style=color:#f92672>]</span>
</code></pre></div><p>Gotcha! üêû</p><h3 id=run-bundle-pristine-to-clear-your-changes>Run <code>bundle pristine</code> to clear your changes<a hidden class=anchor aria-hidden=true href=#run-bundle-pristine-to-clear-your-changes>#</a></h3><p>If you&rsquo;ve changed the code and want to discard any changes, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ bundle pristine
</code></pre></div><p>This will restore the installed gems in the bundle to their pristine condition using the local gem cache from RubyGems. For git gems, a forced checkout will be performed.</p><h2 id=git-bisect-example>6. Find out when the bug was introduced with <code>git bisect</code><a hidden class=anchor aria-hidden=true href=#git-bisect-example>#</a></h2><p>Use <code>git bisect</code> to find the commit that caused the issue. That will give you clues on which files to focus on. You can even use the <a href=#1-run-the-failing-code-to-reproduce-the-bug>test script</a> you&rsquo;ve created to tell you whether a version is <code>good</code> or <code>bad</code>.</p><p>Continuing with our issue, we need to clone the Faker repository:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git clone git@github.com:faker-ruby/faker.git
$ cd faker
</code></pre></div><p>To start the <code>git bisect</code> process, run:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git bisect start
</code></pre></div><p>We know that version <code>v2.20.0</code> is broken (bad) and <code>v2.19.0</code> was working (good), so let&rsquo;s mark them appropriately:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git bisect bad v2.20.0
$ git bisect good v2.19.0
  Bisecting: <span style=color:#ae81ff>38</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>5</span> steps<span style=color:#f92672>)</span>
  <span style=color:#f92672>[</span>2a6f0cc<span style=color:#f92672>]</span> Add general documentation <span style=color:#66d9ef>for</span> Faker::Camera <span style=color:#f92672>(</span><span style=color:#75715e>#2421)</span>
</code></pre></div><p>Now you can let <code>git bisect</code> do its magic by telling it to run your test.
It will jump between revisions, doing a binary search to find where the bug was introduced. It will then mark the revision as either good or bad depending on the output of your test, and stop.</p><p>To run a script/test with <code>git bisect</code>, do the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git bisect run <span style=color:#f92672>[</span>your-test-script<span style=color:#f92672>]</span>
</code></pre></div><p>Here&rsquo;s an example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git bisect run rake test TEST<span style=color:#f92672>=</span>faker_game_title_test.rb
running rake test TEST<span style=color:#f92672>=</span>faker_game_title_test.rb

  Bisecting: <span style=color:#ae81ff>18</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>4</span> steps<span style=color:#f92672>)</span>
  <span style=color:#f92672>[</span>649dd8f<span style=color:#f92672>]</span> Merge pull request <span style=color:#75715e>#2442 from sudeeptarlekar/2309-truffleruby-errors</span>
  running rake test TEST<span style=color:#f92672>=</span>faker_game_title_test.rb

  <span style=color:#f92672>(</span>...<span style=color:#f92672>)</span>
  
  Bisecting: <span style=color:#ae81ff>0</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>1</span> step<span style=color:#f92672>)</span>
  <span style=color:#f92672>[</span>c1998d0<span style=color:#f92672>]</span> Merge pull request <span style=color:#75715e>#2457 from Awilum/patch-2</span>
  running rake test TEST<span style=color:#f92672>=</span>faker_game_title_test.rb
    &lt;nil&gt; was expected to not be nil. <span style=color:#f92672>(</span>Test::Unit::AssertionFailedError<span style=color:#f92672>)</span>

  Bisecting: <span style=color:#ae81ff>0</span> revisions left to test after this <span style=color:#f92672>(</span>roughly <span style=color:#ae81ff>0</span> steps<span style=color:#f92672>)</span>
  <span style=color:#f92672>[</span>722172a<span style=color:#f92672>]</span> add Command &amp; Conquer games
  running rake test TEST<span style=color:#f92672>=</span>faker_game_title_test.rb
    &lt;nil&gt; was expected to not be nil. <span style=color:#f92672>(</span>Test::Unit::AssertionFailedError<span style=color:#f92672>)</span>

  722172a is the first bad commit
  commit 722172a
  Date:   Mon Jan <span style=color:#ae81ff>31</span> 00:52:58 <span style=color:#ae81ff>2022</span> +0300
      add Command &amp; Conquer games
  lib/locales/en/game.yml | <span style=color:#ae81ff>12</span> ++++++++++++
  <span style=color:#ae81ff>1</span> file changed, <span style=color:#ae81ff>12</span> insertions<span style=color:#f92672>(</span>+<span style=color:#f92672>)</span>

  bisect run success
</code></pre></div><p><code>git-bisect</code> found the commit that introduced the bug. And it consists of changes to only one file: <code>lib/locales/en/game.yml</code>. That narrows the list of possible culprits by a lot!</p><p>Really neat, huh?</p><p>With this information, you know exactly which files to look at. When you&rsquo;re done, get back to the original branch by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ git bisect reset
</code></pre></div><p>üí° <em>For a great video explanation on how to use <code>git bisect</code> in a large project, check out the talk <a href="https://youtu.be/7zoD6NZy6vY?t=3057">RailsConf 2015: Breaking Down the Barrier: Demystifying Contributing to Rails @ 50m55s</a> from Eileen Uchitelle.</em></p><h2 id=7-open-a-new-issue-with-reproduction-steps>7. Open a new issue with reproduction steps<a hidden class=anchor aria-hidden=true href=#7-open-a-new-issue-with-reproduction-steps>#</a></h2><p>With reproduction steps in hand, open a new issue describing the error and how to reproduce it. Give the maintainers a script they can run if you have it.</p><p>Since you&rsquo;re here doing all this work, if you have a solution, submit a PR.</p><p>The issue shared here was already solved, but let&rsquo;s pretend you&rsquo;re going to fix it. You know that the problem can be fixed by deleting the empty entry on line 233 in this file <code>lib/locales/en/game.yml</code>.</p><p>After you removed the empty line, build the gem and install it locally:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ gem build faker.gemspec
  Successfully built RubyGem
  Name: faker
  Version: 2.20.0
  File: faker-2.20.0.gem

$ gem install faker-2.20.0.gem
</code></pre></div><p>Now if you run the test again, the problem is fixed. Yay! The next step would be to submit a PR following the repository&rsquo;s guidelines.</p><h2 id=checklist-how-to-quickly-debug-a-ruby-gem>Checklist: How to Quickly Debug a Ruby Gem<a hidden class=anchor aria-hidden=true href=#checklist-how-to-quickly-debug-a-ruby-gem>#</a></h2><p>Let&rsquo;s recap:</p><ol><li>Run the failing code to reproduce the bug</li><li>Run <code>bundle open [gem-name]</code> to access the source code</li><li>Add <code>binding.pry</code> to invoke the debugger</li><li>Run the failing code again</li><li>Explore and debug the code using <code>pry</code></li><li>Find out when the bug was introduced with <code>git bisect</code></li><li>Open a new issue with reproduction steps</li></ol><p>Voil√†! Now you&rsquo;re ready to debug any Ruby gem! üß∞</p><hr><p>By now, you have added a couple of new debugging tricks to your toolbox. Use them on your own projects. <code>git bisect</code> is a neat command to use when debugging any type of project. As well as using <code>pry</code> effectively.</p><p>For more Pry tips, read <a href=https://www.hexdevs.com/posts/pry-debug-in-5-minutes/>Getting Started with Pry Debug in 5 minutes</a>.</p><p>Now go out there and bash some bugs!</p><div class=signup-form><script async data-uid=cee09b7cba src=https://hexdevs-team.ck.page/cee09b7cba/index.js></script></div><br><p>Did you like this article? You're gonna love these other ones:</p><ul><li><a href=/posts/how-to-open-source-with-richard-schneeman-schneems/>How to Open Source with Richard Schneeman (@schneems)</a></li><li><a href=/posts/rails-jbuilder-json-api/>How to RSpec a Jbuilder response from a Rails JSON API</a></li><li><a href=/contribute-ruby-on-rails-guide/>[Guide] How to Contribute to Ruby on Rails</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.hexdevs.com/tags/open-source/>Open Source</a></li><li><a href=https://www.hexdevs.com/tags/ruby/>ruby</a></li><li><a href=https://www.hexdevs.com/tags/ruby-on-rails/>Ruby on Rails</a></li><li><a href=https://www.hexdevs.com/tags/guides/>guides</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on twitter" href="https://twitter.com/intent/tweet/?text=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect&url=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f&hashtags=OpenSource%2cruby%2crubyonrails%2cguides"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f&title=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect&summary=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect&source=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f&title=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on whatsapp" href="https://api.whatsapp.com/send?text=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect%20-%20https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Guide: Quickly Debug a Ruby Gem with Pry and Git Bisect on telegram" href="https://telegram.me/share/url?text=Guide%3a%20Quickly%20Debug%20a%20Ruby%20Gem%20with%20Pry%20and%20Git%20Bisect&url=https%3a%2f%2fwww.hexdevs.com%2fposts%2fdebug-third-party-ruby-gem-with-pry%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.hexdevs.com/>hexdevs</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=https://www.hexdevs.com/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});if(id==="top"){history.replaceState(null,null," ");}else{history.replaceState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>